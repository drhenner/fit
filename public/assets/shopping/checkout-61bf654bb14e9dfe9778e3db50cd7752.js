var UfcFit=window.UfcFit||{};typeof UfcFit.Shopping=="undefined"&&(UfcFit.Shopping={});var debug_variable=null;typeof UfcFit.Shopping.cart=="undefined"&&(UfcFit.Shopping.cart={initialize:function(){Stripe.setPublishableKey($('meta[name="stripe-key"]').attr("content")),$("#purchase_cart_order").submit(function(e){return $(".cart-submit-button").attr("disabled","disabled"),UfcFit.Shopping.cart.submitForm(),!1}),$("#use-card-on-file-button").click(function(){paymentProfileId=$("input[name=use_credit_card_on_file]:checked","#purchase_cart_order").val();if(paymentProfileId>0)return UfcFit.Shopping.cart.submitPaymentProfileForm(),!1;alert("Please select a card.")})},submitPaymentProfileForm:function(){jQuery.ajax({type:"GET",url:"/shopping/orders/xyz",success:function(e){if(e.order.integer_credited_total==UfcFit.Shopping.cart.orderAmount()){var t=$("#purchase_cart_order");t.get(0).submit()}else $(".payment-errors").html("Error handling transaction."),window.location.href="/shopping/orders"},dataType:"json"})},submitForm:function(){UfcFit.Validators.CreditCards.validateNumber(UfcFit.Validators.CreditCards.creditCardInput),UfcFit.Validators.CreditCards.valid?($(".payment-errors").fadeOut(),jQuery.ajax({type:"GET",url:"/shopping/orders/xyz",success:function(e){e.order.integer_credited_total==UfcFit.Shopping.cart.orderAmount()?Stripe.createToken({name:$("#full_name").val(),number:$("#number").val(),cvc:$("#verification_value").val(),exp_month:$("#month").val(),exp_year:$("#year").val()},UfcFit.Shopping.cart.stripeResponseHandler):(alert("payment-errors"),$(".payment-errors").html("Error handling transaction."),window.location.href="/shopping/orders")},dataType:"json"})):UfcFit.Shopping.cart.useCardOnFile()?UfcFit.Shopping.cart.chargeCardOnFile():($(".cart-submit-button").attr("disabled",!1),$(".payment-errors").html("Credit Card is not valid."),$(".payment-errors").fadeIn())},useCardOnFile:function(){var e=jQuery("#card_on_file");return e?e.find("input:checkbox").attr("checked"):!1},chargeCardOnFile:function(){UfcFit.App.helpers.startWaitScreen(),jQuery.ajax({type:"PUT",url:"/shopping/orders/xyz/charge",data:{authenticity_token:$('meta[name="csrf-token"]').attr("content")},success:function(e){e.order.errors?($(".cart-submit-button").attr("disabled",!1),$(".payment-errors").html("There was an error processing this order."),$(".payment-errors").fadeIn(),UfcFit.App.helpers.stopWaitScreen()):window.location.href="/myaccount/orders/"+e.order.number},dataType:"json"})},stripeResponseHandler:function(e,t){if(e!=200||t.error)$(".cart-submit-button").attr("disabled",!1),$(".payment-errors").html(t.error.message),$(".payment-errors").fadeIn();else{var n=$("#purchase_cart_order"),r=t.id;$("#stripe_card_token").val(r),$("#token_amount").val(t.amount),n.get(0).submit()}},lastFour:function(){var e=$("#number").val();return e.replace(/\D/g,"").substring(e.length-4,e.length)},orderAmount:function(){return $("#credited_total").data("integer_credited_total")}},jQuery(function(){UfcFit.Shopping.cart.initialize()}));