/**
 * Copyright (c) 2008 Kelvin Luck (http://www.kelvinluck.com/)
 * Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php) 
 * and GPL (http://www.opensource.org/licenses/gpl-license.php) licenses.
 *
 * $Id: jquery.datePicker.js 15 2008-12-17 04:40:18Z kelvin.luck $
 **/
(function(e){function n(e){this.ele=e,this.displayedMonth=null,this.displayedYear=null,this.startDate=null,this.endDate=null,this.showYearNavigation=null,this.closeOnSelect=null,this.displayClose=null,this.selectMultiple=null,this.verticalPosition=null,this.horizontalPosition=null,this.verticalOffset=null,this.horizontalOffset=null,this.button=null,this.renderCallback=[],this.selectedDates={},this.inline=null,this.context="#dp-popup"}function r(t){return t._dpId?e.event._dpCache[t._dpId]:!1}e.fn.extend({renderCalendar:function(t){var n=function(e){return document.createElement(e)};t=e.extend({},e.fn.datePicker.defaults,t);if(t.showHeader!=e.dpConst.SHOW_HEADER_NONE){var r=e(n("tr"));for(var i=Date.firstDayOfWeek;i<Date.firstDayOfWeek+7;i++){var s=i%7,o=Date.dayNames[s];r.append(jQuery(n("th")).attr({scope:"col",abbr:o,title:o,"class":s==0||s==6?"weekend":"weekday"}).html(t.showHeader==e.dpConst.SHOW_HEADER_SHORT?o.substr(0,1):o))}}var u=e(n("table")).attr({cellspacing:2,className:"jCalendar"}).append(t.showHeader!=e.dpConst.SHOW_HEADER_NONE?e(n("thead")).append(r):n("thead")),a=e(n("tbody")),f=(new Date).zeroTime(),l=t.month==undefined?f.getMonth():t.month,c=t.year||f.getFullYear(),h=new Date(c,l,1),p=Date.firstDayOfWeek-h.getDay()+1;p>1&&(p-=7);var d=Math.ceil((-1*p+1+h.getDaysInMonth())/7);h.addDays(p-1);var v=function(){t.hoverClass&&e(this).addClass(t.hoverClass)},m=function(){t.hoverClass&&e(this).removeClass(t.hoverClass)},g=0;while(g++<d){var y=jQuery(n("tr"));for(var i=0;i<7;i++){var b=h.getMonth()==l,w=e(n("td")).text(h.getDate()+"").attr("className",(b?"current-month ":"other-month ")+(h.isWeekend()?"weekend ":"weekday ")+(b&&h.getTime()==f.getTime()?"today ":"")).hover(v,m);t.renderCallback&&t.renderCallback(w,h,l,c),y.append(w),h.addDays(1)}a.append(y)}return u.append(a),this.each(function(){e(this).empty().append(u)})},datePicker:function(t){return e.event._dpCache||(e.event._dpCache=[]),t=e.extend({},e.fn.datePicker.defaults,t),this.each(function(){var r=e(this),i=!0;this._dpId||(this._dpId=e.event.guid++,e.event._dpCache[this._dpId]=new n(this),i=!1),t.inline&&(t.createButton=!1,t.displayClose=!1,t.closeOnSelect=!1,r.empty());var o=e.event._dpCache[this._dpId];o.init(t),!i&&t.createButton&&(o.button=e('<a href="#" class="dp-choose-date" title="'+e.dpText.TEXT_CHOOSE_DATE+'">'+e.dpText.TEXT_CHOOSE_DATE+"</a>").bind("click",function(){return r.dpDisplay(this),this.blur(),!1}),r.after(o.button));if(!i&&r.is(":text")){r.bind("dateSelected",function(e,t,n){this.value=t.asString()}).bind("change",function(){if(this.value!=""){var e=Date.fromString(this.value);e&&o.setSelected(e,!0,!0)}}),t.clickInput&&r.bind("click",function(){r.dpDisplay()});var u=Date.fromString(this.value);this.value!=""&&u&&o.setSelected(u,!0,!0)}r.addClass("dp-applied")})},dpSetDisabled:function(e){return t.call(this,"setDisabled",e)},dpSetStartDate:function(e){return t.call(this,"setStartDate",e)},dpSetEndDate:function(e){return t.call(this,"setEndDate",e)},dpGetSelected:function(){var e=r(this[0]);return e?e.getSelected():null},dpSetSelected:function(e,n,r){return n==undefined&&(n=!0),r==undefined&&(r=!0),t.call(this,"setSelected",Date.fromString(e),n,r,!0)},dpSetDisplayedMonth:function(e,n){return t.call(this,"setDisplayedMonth",Number(e),Number(n),!0)},dpDisplay:function(e){return t.call(this,"display",e)},dpSetRenderCallback:function(e){return t.call(this,"setRenderCallback",e)},dpSetPosition:function(e,n){return t.call(this,"setPosition",e,n)},dpSetOffset:function(e,n){return t.call(this,"setOffset",e,n)},dpClose:function(){return t.call(this,"_closeCalendar",!1,this[0])},_dpDestroy:function(){}});var t=function(e,t,n,i,s){return this.each(function(){var o=r(this);o&&o[e](t,n,i,s)})};e.extend(n.prototype,{init:function(e){this.setStartDate(e.startDate),this.setEndDate(e.endDate),this.setDisplayedMonth(Number(e.month),Number(e.year)),this.setRenderCallback(e.renderCallback),this.showYearNavigation=e.showYearNavigation,this.closeOnSelect=e.closeOnSelect,this.displayClose=e.displayClose,this.selectMultiple=e.selectMultiple,this.verticalPosition=e.verticalPosition,this.horizontalPosition=e.horizontalPosition,this.hoverClass=e.hoverClass,this.setOffset(e.verticalOffset,e.horizontalOffset),this.inline=e.inline,this.inline&&(this.context=this.ele,this.display())},setStartDate:function(e){e&&(this.startDate=Date.fromString(e)),this.startDate||(this.startDate=(new Date).zeroTime()),this.setDisplayedMonth(this.displayedMonth,this.displayedYear)},setEndDate:function(e){e&&(this.endDate=Date.fromString(e)),this.endDate||(this.endDate=new Date("12/31/2999")),this.endDate.getTime()<this.startDate.getTime()&&(this.endDate=this.startDate),this.setDisplayedMonth(this.displayedMonth,this.displayedYear)},setPosition:function(e,t){this.verticalPosition=e,this.horizontalPosition=t},setOffset:function(e,t){this.verticalOffset=parseInt(e)||0,this.horizontalOffset=parseInt(t)||0},setDisabled:function(t){$e=e(this.ele),$e[t?"addClass":"removeClass"]("dp-disabled"),this.button&&($but=e(this.button),$but[t?"addClass":"removeClass"]("dp-disabled"),$but.attr("title",t?"":e.dpText.TEXT_CHOOSE_DATE)),$e.is(":text")&&$e.attr("disabled",t?"disabled":"")},setDisplayedMonth:function(t,n,r){if(this.startDate==undefined||this.endDate==undefined)return;var i=new Date(this.startDate.getTime());i.setDate(1);var s=new Date(this.endDate.getTime());s.setDate(1);var o;!t&&!n||isNaN(t)&&isNaN(n)?(o=(new Date).zeroTime(),o.setDate(1)):isNaN(t)?o=new Date(n,this.displayedMonth,1):isNaN(n)?o=new Date(this.displayedYear,t,1):o=new Date(n,t,1),o.getTime()<i.getTime()?o=i:o.getTime()>s.getTime()&&(o=s);var u=this.displayedMonth,a=this.displayedYear;this.displayedMonth=o.getMonth(),this.displayedYear=o.getFullYear(),r&&(this.displayedMonth!=u||this.displayedYear!=a)&&(this._rerenderCalendar(),e(this.ele).trigger("dpMonthChanged",[this.displayedMonth,this.displayedYear]))},setSelected:function(t,n,r,i){if(n==this.isSelected(t))return;this.selectMultiple==0&&(this.selectedDates={},e("td.selected",this.context).removeClass("selected")),r&&this.displayedMonth!=t.getMonth()&&this.setDisplayedMonth(t.getMonth(),t.getFullYear(),!0),this.selectedDates[t.toString()]=n;var s="td.";s+=t.getMonth()==this.displayedMonth?"current-month":"other-month",s+=':contains("'+t.getDate()+'")';var o;e(s,this.ele).each(function(){e(this).text()==t.getDate()&&(o=e(this),o[n?"addClass":"removeClass"]("selected"))});if(i){var u=this.isSelected(t);$e=e(this.ele),$e.trigger("dateSelected",[t,o,u]),$e.trigger("change")}},isSelected:function(e){return this.selectedDates[e.toString()]},getSelected:function(){var e=[];for(s in this.selectedDates)this.selectedDates[s]==1&&e.push(Date.parse(s));return e},display:function(t){if(e(this.ele).is(".dp-disabled"))return;t=t||this.ele;var n=this,r=e(t),i=r.offset(),s,o,u,a;if(n.inline)s=e(this.ele),o={id:"calendar-"+this.ele._dpId,className:"dp-popup dp-popup-inline"},a={};else{s=e("body"),o={id:"dp-popup",className:"dp-popup"},a={top:i.top+n.verticalOffset,left:i.left+n.horizontalOffset};var f=function(t){var r=t.target,i=e("#dp-popup")[0];for(;;){if(r==i)return!0;if(r==document)return n._closeCalendar(),!1;r=e(r).parent()[0]}};this._checkMouse=f,this._closeCalendar(!0)}s.append(e("<div></div>").attr(o).css(a).append(e("<h2></h2>"),e('<div class="dp-nav-prev"></div>').append(e('<a class="dp-nav-prev-year" href="#" title="'+e.dpText.TEXT_PREV_YEAR+'">&lt;&lt;</a>').bind("click",function(){return n._displayNewMonth.call(n,this,0,-1)}),e('<a class="dp-nav-prev-month" href="#" title="'+e.dpText.TEXT_PREV_MONTH+'">&lt;</a>').bind("click",function(){return n._displayNewMonth.call(n,this,-1,0)})),e('<div class="dp-nav-next"></div>').append(e('<a class="dp-nav-next-year" href="#" title="'+e.dpText.TEXT_NEXT_YEAR+'">&gt;&gt;</a>').bind("click",function(){return n._displayNewMonth.call(n,this,0,1)}),e('<a class="dp-nav-next-month" href="#" title="'+e.dpText.TEXT_NEXT_MONTH+'">&gt;</a>').bind("click",function(){return n._displayNewMonth.call(n,this,1,0)})),e("<div></div>").attr("className","dp-calendar")).bgIframe());var l=this.inline?e(".dp-popup",this.context):e("#dp-popup");this.showYearNavigation==0&&e(".dp-nav-prev-year, .dp-nav-next-year",n.context).css("display","none"),this.displayClose&&l.append(e('<a href="#" id="dp-close">'+e.dpText.TEXT_CLOSE+"</a>").bind("click",function(){return n._closeCalendar(),!1})),n._renderCalendar(),e(this.ele).trigger("dpDisplayed",l),n.inline||(this.verticalPosition==e.dpConst.POS_BOTTOM&&l.css("top",i.top+r.height()-l.height()+n.verticalOffset),this.horizontalPosition==e.dpConst.POS_RIGHT&&l.css("left",i.left+r.width()-l.width()+n.horizontalOffset),e(document).bind("mousedown",this._checkMouse))},setRenderCallback:function(e){if(e==null)return;e&&typeof e=="function"&&(e=[e]),this.renderCallback=this.renderCallback.concat(e)},cellRender:function(t,n,r,i){var s=this.dpController,o=new Date(n.getTime());t.bind("click",function(){var t=e(this);t.is(".disabled")||(s.setSelected(o,!t.is(".selected")||!s.selectMultiple,!1,!0),s.closeOnSelect&&s._closeCalendar())}),s.isSelected(o)&&t.addClass("selected");for(var u=0;u<s.renderCallback.length;u++)s.renderCallback[u].apply(this,arguments)},_displayNewMonth:function(t,n,r){return e(t).is(".disabled")||this.setDisplayedMonth(this.displayedMonth+n,this.displayedYear+r,!0),t.blur(),!1},_rerenderCalendar:function(){this._clearCalendar(),this._renderCalendar()},_renderCalendar:function(){e("h2",this.context).html(Date.monthNames[this.displayedMonth]+" "+this.displayedYear),e(".dp-calendar",this.context).renderCalendar({month:this.displayedMonth,year:this.displayedYear,renderCallback:this.cellRender,dpController:this,hoverClass:this.hoverClass});if(this.displayedYear==this.startDate.getFullYear()&&this.displayedMonth==this.startDate.getMonth()){e(".dp-nav-prev-year",this.context).addClass("disabled"),e(".dp-nav-prev-month",this.context).addClass("disabled"),e(".dp-calendar td.other-month",this.context).each(function(){var t=e(this);Number(t.text())>20&&t.addClass("disabled")});var t=this.startDate.getDate();e(".dp-calendar td.current-month",this.context).each(function(){var n=e(this);Number(n.text())<t&&n.addClass("disabled")})}else{e(".dp-nav-prev-year",this.context).removeClass("disabled"),e(".dp-nav-prev-month",this.context).removeClass("disabled");var t=this.startDate.getDate();if(t>20){var n=new Date(this.startDate.getTime());n.addMonths(1),this.displayedYear==n.getFullYear()&&this.displayedMonth==n.getMonth()&&e("dp-calendar td.other-month",this.context).each(function(){var n=e(this);Number(n.text())<t&&n.addClass("disabled")})}}if(this.displayedYear==this.endDate.getFullYear()&&this.displayedMonth==this.endDate.getMonth()){e(".dp-nav-next-year",this.context).addClass("disabled"),e(".dp-nav-next-month",this.context).addClass("disabled"),e(".dp-calendar td.other-month",this.context).each(function(){var t=e(this);Number(t.text())<14&&t.addClass("disabled")});var t=this.endDate.getDate();e(".dp-calendar td.current-month",this.context).each(function(){var n=e(this);Number(n.text())>t&&n.addClass("disabled")})}else{e(".dp-nav-next-year",this.context).removeClass("disabled"),e(".dp-nav-next-month",this.context).removeClass("disabled");var t=this.endDate.getDate();if(t<13){var r=new Date(this.endDate.getTime());r.addMonths(-1),this.displayedYear==r.getFullYear()&&this.displayedMonth==r.getMonth()&&e(".dp-calendar td.other-month",this.context).each(function(){var n=e(this);Number(n.text())>t&&n.addClass("disabled")})}}},_closeCalendar:function(t,n){if(!n||n==this.ele)e(document).unbind("mousedown",this._checkMouse),this._clearCalendar(),e("#dp-popup a").unbind(),e("#dp-popup").empty().remove(),t||e(this.ele).trigger("dpClosed",[this.getSelected()])},_clearCalendar:function(){e(".dp-calendar td",this.context).unbind(),e(".dp-calendar",this.context).empty()}}),e.dpConst={SHOW_HEADER_NONE:0,SHOW_HEADER_SHORT:1,SHOW_HEADER_LONG:2,POS_TOP:0,POS_BOTTOM:1,POS_LEFT:0,POS_RIGHT:1},e.dpText={TEXT_PREV_YEAR:"Previous year",TEXT_PREV_MONTH:"Previous month",TEXT_NEXT_YEAR:"Next year",TEXT_NEXT_MONTH:"Next month",TEXT_CLOSE:"Close",TEXT_CHOOSE_DATE:"Choose date"},e.dpVersion="$Id: jquery.datePicker.js 15 2008-12-17 04:40:18Z kelvin.luck $",e.fn.datePicker.defaults={month:undefined,year:undefined,showHeader:e.dpConst.SHOW_HEADER_SHORT,startDate:undefined,endDate:undefined,inline:!1,renderCallback:null,createButton:!0,showYearNavigation:!0,closeOnSelect:!0,displayClose:!1,selectMultiple:!1,clickInput:!1,verticalPosition:e.dpConst.POS_TOP,horizontalPosition:e.dpConst.POS_LEFT,verticalOffset:0,horizontalOffset:0,hoverClass:"dp-hover"},e.fn.bgIframe==undefined&&(e.fn.bgIframe=function(){return this}),e(window).bind("unload",function(){var t=e.event._dpCache||[];for(var n in t)e(t[n].ele)._dpDestroy()})})(jQuery);