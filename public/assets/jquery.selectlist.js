/*
 * selectList jQuery plugin
 * version 0.2
 *
 * Copyright (c) 2009-2010 Michal Wojciechowski (odyniec.net)
 *
 * Dual licensed under the MIT (MIT-LICENSE.txt)
 * and GPL (GPL-LICENSE.txt) licenses.
 *
 * http://odyniec.net/projects/selectlist/
 *
 */
(function(e){e.selectList=function(t,n){function d(e,t){n.addAnimate&&a?typeof n.addAnimate=="function"?n.addAnimate(e.hide().get(0),t):e.hide().fadeIn(300,t):(e.show(),t&&t.call(e.get(0)))}function v(e,t){n.removeAnimate&&a?typeof n.removeAnimate=="function"?n.removeAnimate(e.get(0),t):e.fadeOut(300,t):(e.hide(),t&&t.call(e.get(0)))}function m(t,r){return typeof n.sort=="function"?n.sort(t,r):e(t).data("text")>e(r).data("text")==(n.sort!="desc")}function g(u,a,l){o=null;if(e(u).is("option")){o=e(u);if(o.get(0).index<f)return;n.duplicates||o.attr("disabled","disabled").data("disabled",!0),u=o.val(),a=o.text()}s=e(n.template.replace(/%text%/g,a).replace(/%value%/g,u)).hide(),e('<input type="hidden" />').appendTo(s).attr({name:e(t).attr("name"),value:u}),s.data("value",u).data("text",a),o&&s.data("option",o),s.addClass(n.classPrefix+"-item"),n.clickRemove&&s.click(function(){y(e(this))}),f&&!h&&(t.selectedIndex=0);var c=function(){l!==!1&&n.onAdd(t,u,a)};if(n.sort&&(i=r.children().eq(0)).length){while(i.length&&m(s.get(0),i.get(0)))i=i.next();i.length?d(s.insertBefore(i),c):d(s.appendTo(r),c)}else d(s.appendTo(r),c)}function y(r,i){v(r,function(){var r=e(this).data("value"),s=e(this).data("text");e(this).data("option")&&e(this).data("option").removeAttr("disabled").removeData("disabled"),e(this).remove(),i!==!1&&n.onRemove(t,r,s)})}var r,i,s,o,u,a,f=0,l,c,h,p;this.add=function(e,t){g(e,t)},this.remove=function(t){r.children().each(function(){e(this).data("value")==t&&y(e(this))})},this.setOptions=function(t){var i=t.sort&&t.sort!=n.sort;n=e.extend(n,t),i&&r.children().slice(f).each(function(){g(e(this).data("value"),e(this).data("text"),!1)}).remove()},this.setOptions(n=e.extend({addAnimate:!0,classPrefix:"selectlist",clickRemove:!0,removeAnimate:!0,template:"<li>%text%</li>",onAdd:function(){},onRemove:function(){}},n)),(r=e(n.list||e("<ul />").insertAfter(e(t)))).addClass(n.classPrefix+"-list"),e(t).find(":selected").each(function(){g(e(this),null,!1)}),e(t).removeAttr("multiple"),e(t).attr("title")&&(e(t).prepend(e('<option selected="selected" />').text(e(t).attr("title"))),f=1),u=e.browser.msie||e.browser.safari?"keydown":"keypress",e(t).bind(u,function(n){h=!0;if((n.keyCode||n.which)==13)return p=!0,e(t).change(),h=!0,!1}).change(function(){if(!h&&!c)return;l=!0,o=e(t).find("option:selected"),!o.data("disabled")&&(!h||p)&&g(o),h&&(h=l=c=!1),p=!1}).mousedown(function(){c=!0}),e(t).find("option").click(function(n){return e.browser.mozilla&&n.pageX>=e(t).offset().left&&n.pageX<=e(t).offset().left+e(t).outerWidth()&&n.pageY>=e(t).offset().top&&n.pageY<=e(t).offset().top+e(t).outerHeight()?!1:(c=!0,e(this).attr("disabled")||e(this).data("disabled")||h||l||g(e(this)),h||(l=c=!1),!1)}),e(t.form).submit(function(){e(t).removeAttr("name")}),e(window).bind("beforeunload",function(){e(t).removeAttr("name")}),a=!0},e.fn.selectList=function(t){return t=t||{},this.filter("select").each(function(){e(this).data("selectList")?e(this).data("selectList").setOptions(t):e(this).data("selectList",new e.selectList(this,t))}),t.instance?e(this).filter("select").data("selectList"):this}})(jQuery);